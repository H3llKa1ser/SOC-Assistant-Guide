# Malware Persistence

## Services and Tasks

Here is a very simple table with persistence methods

| Persistence Method | Description | Attack Example | Event ID Logging |
|-------------------|-------------|----------------|------------------|
| Create a Windows Service | Runs after OS startup | `sc create "BadService" binpath= "C:\malware.exe" start= auto` | Launch of `sc.exe`: **Sysmon / Event ID 1**<br>Service creation: **Security / Event ID 4697** |
| Create a Scheduled Task | Run after OS startup | `schtasks /create /tn "BadTask" /tr "C:\malware.exe" /sc onstart /ru System` | Launch of `schtasks.exe`: **Sysmon / Event ID 1**<br>Scheduled task creation: **Security / Event ID 4698** |

## Service Detection

Steps

### 1) Detect process launch (Sysmon ID 1)

    sc.exe create

### 2) Detect service creation (Security Log ID 4697 / System Log ID 7045)

### 3) Detect suspicious processes with a "services.exe" parent process

You can also go to "Services" in the GUI and search for any suspicious service names.

## Task Detection

Steps

### 1) Detect process launch (Sysmon ID 1)

    schtasks.exe /create

### 2) Detect and analyze task creation events (Security event ID 4698)

### 3) Detect suspicious processes with a parent like:

    svchost.exe [...] -s Suspicious
